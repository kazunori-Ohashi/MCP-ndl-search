# NDL MCP ã‚µãƒ¼ãƒãƒ¼åˆ©ç”¨ã‚¬ã‚¤ãƒ‰

## ğŸš€ Claude Desktop ã§ã®åˆ©ç”¨æ–¹æ³•

### 1. è¨­å®šå®Œäº†ã®ç¢ºèª

Claude Desktopè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒæ­£ã—ãé…ç½®ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªï¼š
```bash
cat ~/Library/Application\ Support/Claude/claude_desktop_config.json
```

### 2. Claude Desktopå†èµ·å‹•

è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤‰æ›´ã—ãŸå¾Œã¯ã€Claude Desktopã‚’å®Œå…¨ã«å†èµ·å‹•ã—ã¦ãã ã•ã„ï¼š
1. Claude Desktopã‚’çµ‚äº†ï¼ˆCmd+Qï¼‰
2. Claude Desktopã‚’å†åº¦èµ·å‹•

### 3. MCPæ¥ç¶šç¢ºèª

Claude Desktopã§æ–°ã—ã„ä¼šè©±ã‚’é–‹å§‹ã—ã€ä»¥ä¸‹ã®ã„ãšã‚Œã‹ã‚’ç¢ºèªï¼š
- ç”»é¢ä¸‹éƒ¨ã«ã€ŒğŸ”§ã€ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆMCP Toolsï¼‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- ã€ŒAvailable tools: ndl-searchã€ã®ã‚ˆã†ãªè¡¨ç¤ºãŒå‡ºã‚‹

## ğŸ”§ åˆ©ç”¨å¯èƒ½ãªãƒ„ãƒ¼ãƒ«

### `ndl_search_books` - è‡ªç„¶è¨€èªæ¤œç´¢
```
ã€Œæ²–ç¸„ã®è–¬è‰ã«é–¢ã™ã‚‹2015å¹´ä»¥é™ã®æ›¸ç±ã‚’3å†Šæ¤œç´¢ã—ã¦ã€
```

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**
- `query`: è‡ªç„¶è¨€èªæ¤œç´¢ã‚¯ã‚¨ãƒª
- `maxRecords`: æœ€å¤§ä»¶æ•°ï¼ˆ1-200ã€æ—¢å®š20ï¼‰
- `preferLanguage`: å„ªå…ˆè¨€èªï¼ˆæ—¢å®š"jpn"ï¼‰
- `publishToMcp`: MCPé…ä¿¡ã™ã‚‹ã‹ï¼ˆæ—¢å®štrueï¼‰

### `ndl_sru_search` - CQLç›´æ¥æ¤œç´¢
```
ã€ŒCQLã‚¯ã‚¨ãƒª 'isbn=9784334779146' ã§1ä»¶æ¤œç´¢ã—ã¦ã€
```

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**
- `cql`: CQLã‚¯ã‚¨ãƒªæ–‡å­—åˆ—
- `maximumRecords`: æœ€å¤§ä»¶æ•°ï¼ˆ1-200ã€æ—¢å®š20ï¼‰
- `startRecord`: é–‹å§‹ä½ç½®ï¼ˆ1ãƒ™ãƒ¼ã‚¹ã€æ—¢å®š1ï¼‰
- `format`: å¿œç­”å½¢å¼ï¼ˆæ—¢å®š"dcndl"ï¼‰

## ğŸ“ ä½¿ç”¨ä¾‹

### ä¾‹1: è‡ªç„¶è¨€èªæ¤œç´¢
```
ã€Œé å·æµèŒ¶é“ã®æœˆåˆŠèªŒã«ã¤ã„ã¦ã€2020å¹´ä»¥é™ã®è³‡æ–™ã‚’5å†Šæ¤œç´¢ã—ã¦ãã ã•ã„ã€
```

### ä¾‹2: ISBNæ¤œç´¢
```
ã€ŒISBN 9784334779146 ã®æ›¸ç±æƒ…å ±ã‚’æ¤œç´¢ã—ã¦ãã ã•ã„ã€
```

### ä¾‹3: å°‚é–€çš„ãªCQLæ¤œç´¢
```
ã€ŒCQLã‚¯ã‚¨ãƒª 'subject="èŒ¶é“" AND issued>=2020 AND language="jpn"' ã§10ä»¶æ¤œç´¢ã—ã¦ãã ã•ã„ã€
```

## ğŸ› ï¸ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### MCPãƒ„ãƒ¼ãƒ«ãŒè¡¨ç¤ºã•ã‚Œãªã„å ´åˆ

1. **è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª**
   ```bash
   cat ~/Library/Application\ Support/Claude/claude_desktop_config.json
   ```

2. **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‘ã‚¹ç¢ºèª**
   ```bash
   pwd  # /Users/kaz005/ndl ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
   ```

3. **ä¾å­˜é–¢ä¿‚ç¢ºèª**
   ```bash
   cd /Users/kaz005/ndl
   npm install
   npm test
   ```

4. **Claude Desktopå®Œå…¨å†èµ·å‹•**
   - Activity Monitor ã§ Claude Desktop ãƒ—ãƒ­ã‚»ã‚¹ã‚’çµ‚äº†
   - å†åº¦èµ·å‹•

### ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ç¢ºèª

Claude Desktop ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã‚’ç¢ºèªï¼š
```bash
log show --predicate 'process == "Claude"' --info --last 10m
```

### ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã¨å¯¾å‡¦æ³•

**1. `ENOENT: no such file or directory, open '//package.json'`**

åŸå› ï¼šä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæœªæŒ‡å®šãƒ»npmçµŒç”±ã§package.jsonã‚’æ¢ç´¢ã™ã‚‹ãŸã‚ã€‚
å¯¾å‡¦ï¼šnpmå®Œå…¨æ’é™¤ãƒ»cwdå›ºå®šãƒ»stdoutæ±šæŸ“ã‚¼ãƒ­ã®ã‚·ã‚§ãƒ«ãƒ©ãƒƒãƒ‘ä½¿ç”¨ï¼š
```json
{
  "mcpServers": {
    "ndl-search": {
      "command": "/Users/kaz005/ndl/.mcp/run.sh"
    }
  }
}
```

ã‚·ã‚§ãƒ«ãƒ©ãƒƒãƒ‘ï¼ˆ`/Users/kaz005/ndl/.mcp/run.sh`ï¼‰:
```bash
#!/usr/bin/env bash
set -euo pipefail
cd /Users/kaz005/ndl
exec ./node_modules/.bin/tsx src/cli/mcp.ts
```

**2. `Unexpected token 'N' ... not valid JSON`**

åŸå› ï¼šMCPã‚µãƒ¼ãƒãƒ¼ãŒæ¨™æº–å‡ºåŠ›ã«JSONä»¥å¤–ã®æ–‡å­—åˆ—ã‚’å‡ºåŠ›ï¼ˆä¾‹ï¼šnvmã®"Now using..."ï¼‰ã€‚
å¯¾å‡¦ï¼šnpmã®--silentãƒ•ãƒ©ã‚°è¿½åŠ ã€ãƒ©ãƒ³ãƒãƒ£ãƒ¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯æ¨™æº–ã‚¨ãƒ©ãƒ¼å‡ºåŠ›ã®ã¿ä½¿ç”¨ã€‚

**3. `tsx not found` ã¾ãŸã¯ TypeScript ã‚¨ãƒ©ãƒ¼**

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ“ãƒ«ãƒ‰ã—ã¦ãã ã•ã„ï¼š
```bash
cd /Users/kaz005/ndl
npm run build
npm test
```

**4. å‹•ä½œç¢ºèªãƒã‚¤ãƒ³ãƒˆ**

æ­£å¸¸èµ·å‹•æ™‚ã€Claude Desktop ã® stderr ãƒ­ã‚°ã«ä»¥ä¸‹ãŒè¡¨ç¤ºï¼š
- `NDL MCP Server started on stdio`
- `Environment: development`
- `Available tools: ndl_search_books, ndl_sru_search`

## ğŸ”‘ OpenAI API ã‚­ãƒ¼è¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

å®Ÿéš›ã®LLMæ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ã€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã® `OPENAI_API_KEY` ã‚’å®Ÿéš›ã®ã‚­ãƒ¼ã«å¤‰æ›´ï¼š

```json
{
  "mcpServers": {
    "ndl-search": {
      "env": {
        "OPENAI_API_KEY": "sk-your-actual-openai-api-key-here"
      }
    }
  }
}
```

## ğŸ“Š æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ

- **æ¤œç´¢çµæœ**: `{count: number, records: NdlRecord[]}` å½¢å¼
- **ãƒ¬ã‚³ãƒ¼ãƒ‰ID**: ã™ã¹ã¦ `ndl:` ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ä»˜ã
- **è¨€èªå„ªå…ˆ**: `preferLanguage="jpn"` ã§æ—¥æœ¬èªæ–‡çŒ®ãŒå„ªå…ˆè¡¨ç¤º
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: æ¤œç´¢å¤±æ•—æ™‚ã¯é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º

## ğŸ¯ æˆåŠŸç¢ºèª

æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã‚‹å ´åˆï¼š
1. Claude Desktopã§ãƒ„ãƒ¼ãƒ«ã‚¢ã‚¤ã‚³ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹
2. è‡ªç„¶è¨€èªã§NDLæ¤œç´¢ãŒå®Ÿè¡Œã§ãã‚‹
3. æ¤œç´¢çµæœãŒæ§‹é€ åŒ–ã•ã‚ŒãŸå½¢å¼ã§è¿”ã•ã‚Œã‚‹
4. æ—¥æœ¬èªã®æ›¸ç±æƒ…å ±ãŒé©åˆ‡ã«è¡¨ç¤ºã•ã‚Œã‚‹